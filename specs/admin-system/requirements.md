# 需求文档 - 日新智课管理员端系统（MVP版本）

## 介绍

日新智课管理员端是一个基于 Vue3 + Element Plus + CloudBase 的 Web 管理系统，用于审核教师排课申请和自动分配实验室。本版本采用 **最小可行产品（MVP）** 原则，聚焦核心功能，确保快速上线。

## 核心业务流程

```
教师提交申请 → 管理员审核（通过/拒绝）→ 自动排课 → 查看排课结果
```

---

## 设计规范

### UI 框架
- **组件库：** Element Plus
- **布局方式：** 左侧菜单 + 顶部导航 + 主内容区
- **参考项目：** 燕小圈后台管理系统

### 主题配色

**北京工业大学（BJUT）官方配色：**
- **主色：** `#0096C2`（BJUT 蓝）- 按钮、链接、导航
- **成功：** `#67C23A`（绿色）- 已通过
- **警告：** `#E6A23C`（橙色）- 待审核
- **危险：** `#F56C6C`（红色）- 已拒绝
- **背景：** `#F5F5F5`（浅灰）- 页面背景
- **白色：** `#FFFFFF` - 卡片背景

**禁止使用：** 渐变色、彩虹色、紫色等非官方配色

### 视觉资源

**Logo 资源（位于 `public/school/`）：**
- 校徽：`school-logo-377x378.png`
- 校徽+校名横版：`school-logo-with-name-horizontal-1218x378.png`
- 校训：`school-motto-810x134.png`
- 图书馆logo：`school-library-579x299.png`

**轮播图（位于 `public/carousel/`）：**
- 校园风景轮播图（用于登录页背景）

---

## MVP 核心功能（3个模块）

### 功能 1 - 数据看板

**用户故事：** 作为管理员，我希望在首页看到关键统计数据，以便快速了解待处理事项。

#### 验收标准

1. When 管理员进入系统首页时，系统应当显示4个统计卡片：
   - 待审核申请数量
   - 本学期申请总数  
   - 已排课数量
   - 冲突数量

2. When 统计卡片存在时，系统应当显示图标、数字和标题

3. When 管理员点击卡片时，系统应当跳转到对应页面

**UI 参考：**
- 4个卡片横向排列
- 使用 Element Plus 卡片组件（el-card）
- 主色调为 BJUT 蓝（#0096C2）

**MVP 简化：**
- ❌ 删除趋势图表（环比上周）
- ❌ 删除饼图、柱状图、折线图
- ✅ 仅保留核心统计数字

---

### 功能 2 - 申请审核

**用户故事：** 作为管理员，我希望能够查看、筛选和审核教师提交的排课申请。

#### 验收标准

1. When 管理员进入申请审核页面时，系统应当显示所有申请的表格，按提交时间倒序

2. When 表格存在数据时，系统应当显示以下列：
   - 申请编号
   - 教师姓名
   - 课程名称
   - 学生人数
   - 申请时间
   - 状态标签（待审核/已通过/已拒绝）
   - 操作列（查看详情、通过、拒绝）

3. When 管理员选择状态筛选时，系统应当只显示对应状态的申请

4. When 管理员点击"查看详情"时，系统应当弹出对话框显示完整信息：
   - 基本信息（学年学期、课程代码、课程类型）
   - 课程信息（课程名称、班级、学生人数、课时）
   - 时间段表格（星期、周次范围、节次范围）
   - 要求（软件环境、其他要求）
   - 教师信息（姓名、电话、邮箱）

5. When 管理员点击"通过"按钮时，系统应当弹出确认对话框，确认后更新状态为"已通过"

6. When 管理员点击"拒绝"按钮时，系统应当弹出输入框要求填写拒绝理由，提交后更新状态为"已拒绝"

7. When 审核成功后，系统应当显示成功提示并自动刷新列表

**UI 参考：**
- 使用 Element Plus 表格组件（el-table）
- 状态使用 el-tag（不同颜色）
- 对话框使用 el-dialog

**MVP 简化：**
- ❌ 删除搜索功能
- ❌ 删除批量审核
- ❌ 删除分页（显示全部）
- ✅ 保留核心的查看、通过、拒绝

---

### 功能 3 - 自动排课

**用户故事：** 作为管理员，我希望系统能够自动为已通过的申请分配实验室。

#### 验收标准

1. When 管理员进入排课管理页面时，系统应当显示"已通过但未排课"的申请列表

2. When 管理员点击某个申请的"自动排课"按钮时，系统应当：
   - 根据学生人数匹配实验室容量
   - 检测所有候选实验室的时间冲突
   - 返回排课结果

3. When 自动排课成功时，系统应当：
   - 显示成功提示，包含分配的实验室信息
   - 创建排课记录
   - 从列表中移除该申请

4. When 自动排课失败（存在冲突）时，系统应当：
   - 显示错误提示（提示冲突原因）
   - 保留在列表中供手动处理

5. When 管理员点击"批量自动排课"按钮时，系统应当依次处理所有申请，完成后显示结果统计

**排课算法（简化版）：**
```
1. 查询所有正常状态的实验室
2. 按容量从小到大排序（优先使用小实验室）
3. 遍历实验室，检查容量是否满足（lab.capacity >= student_count）
4. 检查时间是否冲突（查询 schedule 集合）
5. 无冲突则分配，有冲突则继续下一个实验室
6. 所有实验室都冲突则失败
```

**UI 参考：**
- 使用 Element Plus 表格 + 按钮
- 成功用绿色通知，失败用红色警告

**MVP 简化：**
- ❌ 删除软件环境匹配（暂不考虑）
- ❌ 删除冲突记录功能
- ❌ 删除手动排课功能
- ✅ 仅保留简单的容量+时间冲突检测

---

## 辅助功能（3个页面）

### 页面 4 - 登录页

**验收标准：**

1. When 用户访问系统时，系统应当显示登录页

2. When 登录页加载时，系统应当显示：
   - 左侧：校园轮播图背景
   - 右侧：登录表单
   - 顶部：BJUT 校徽+校名横版

3. When 用户输入用户名和密码后，系统应当调用 CloudBase 匿名登录

4. When 登录成功后，系统应当跳转到首页（数据看板）

**MVP 简化：**
- ❌ 删除账号密码登录
- ✅ 直接使用 CloudBase 匿名登录（点击"进入系统"按钮）
- ✅ 前端展示 BJUT 视觉元素

---

### 页面 5 - 排课结果

**验收标准：**

1. When 管理员进入排课结果页面时，系统应当显示所有已排课的记录表格

2. When 表格存在数据时，系统应当显示：
   - 课程名称
   - 教师姓名
   - 实验室（建筑 + 房间号）
   - 时间段（周几、第几周、第几节）
   - 排课时间

3. When 管理员选择学年学期筛选时，系统应当只显示对应学期的排课

**MVP 简化：**
- ❌ 删除导出 Excel
- ❌ 删除日历视图
- ❌ 删除取消排课
- ✅ 仅提供只读查看

---

### 页面 6 - 系统布局

**验收标准：**

1. When 用户登录后，系统应当显示经典后台管理布局：
   - 左侧：可折叠菜单栏（BJUT 蓝背景）
   - 顶部：导航栏（用户信息 + 退出按钮）
   - 主区：内容区

2. When 菜单栏展开时，系统应当显示：
   - Logo（BJUT 校徽）
   - 菜单项：数据看板、申请审核、排课管理、排课结果

3. When 用户点击菜单项时，系统应当切换到对应页面

**UI 参考：**
- 参考燕小圈后台布局
- 左侧菜单宽度：200px（展开）/ 64px（收起）
- 顶部高度：60px

---

## 数据库设计（沿用已有）

### 使用的集合

| 集合名 | 用途 |
|--------|------|
| booking | 排课申请记录 |
| rx_user | 用户信息 |
| labs | 实验室信息 |
| schedule | 排课结果 |
| booking_time_slots | 申请时间段 |

### 关键字段

**booking 集合：**
- `status`: 0=待审核, 1=已通过, 2=已拒绝
- `is_scheduled`: 0=未排课, 1=已排课

**schedule 集合：**
- `booking_id`: 关联申请ID
- `lab_id`: 分配的实验室ID
- `weekday`: 星期几
- `week_start`, `week_end`: 周次范围
- `period_start`, `period_end`: 节次范围

---

## 云函数设计（5个）

### 函数 1 - getBookingList

**功能：** 查询申请列表

**参数：**
```javascript
{
  status: 0,      // 可选，状态筛选
  pageSize: 100   // 固定返回100条（MVP不分页）
}
```

**返回：**
```javascript
{
  success: true,
  data: [ /* 申请列表 */ ],
  total: 10
}
```

---

### 函数 2 - reviewBooking

**功能：** 审核申请（通过/拒绝）

**参数：**
```javascript
{
  bookingId: 123,
  action: 'approve',    // approve=通过, reject=拒绝
  remark: '审核意见'    // 拒绝时必填
}
```

**返回：**
```javascript
{
  success: true,
  message: '审核成功'
}
```

---

### 函数 3 - autoSchedule

**功能：** 自动排课

**参数：**
```javascript
{
  bookingId: 123
}
```

**返回（成功）：**
```javascript
{
  success: true,
  message: '排课成功',
  data: {
    labId: 1,
    labName: '软件楼 505'
  }
}
```

**返回（失败）：**
```javascript
{
  success: false,
  message: '所有实验室在该时间段都已被占用'
}
```

---

### 函数 4 - getStatistics

**功能：** 获取统计数据

**参数：** 无

**返回：**
```javascript
{
  success: true,
  data: {
    pending: 5,      // 待审核数量
    total: 20,       // 本学期总数
    scheduled: 12,   // 已排课数量
    conflict: 3      // 冲突数量（MVP暂为0）
  }
}
```

---

### 函数 5 - getScheduleList

**功能：** 查询排课结果

**参数：**
```javascript
{
  academicYear: '2025-2026',  // 可选
  semester: '第一学期'        // 可选
}
```

**返回：**
```javascript
{
  success: true,
  data: [ /* 排课列表 */ ]
}
```

---

## 技术栈总结

### 前端
- **框架：** Vue 3（Composition API）
- **UI 库：** Element Plus
- **路由：** Vue Router 4
- **状态管理：** 暂不使用（MVP 简化）
- **HTTP 客户端：** CloudBase JS SDK

### 后端
- **云函数：** Node.js 18.15 + wx-server-sdk
- **数据库：** 云数据库（NoSQL）

### 部署
- **前端：** 云开发静态托管
- **后端：** 云函数

---

## 开发优先级

### Phase 1 - 基础框架（Day 1）
- ✅ 搭建项目脚手架
- ✅ 配置 Element Plus + BJUT 主题
- ✅ 实现登录页（匿名登录）
- ✅ 实现系统布局（左侧菜单 + 顶部导航）

### Phase 2 - 核心功能（Day 2-3）
- ✅ 实现申请审核页面
- ✅ 开发云函数：getBookingList, reviewBooking
- ✅ 实现数据看板
- ✅ 开发云函数：getStatistics

### Phase 3 - 自动排课（Day 4-5）
- ✅ 实现排课管理页面
- ✅ 开发云函数：autoSchedule（含冲突检测算法）
- ✅ 实现排课结果页面
- ✅ 开发云函数：getScheduleList

### Phase 4 - 测试部署（Day 6）
- ✅ 功能测试
- ✅ 部署云函数
- ✅ 部署前端到静态托管
- ✅ 文档整理

---

## 页面原型（文字描述）

### 登录页
```
┌─────────────────────────────────────┐
│    【BJUT 校徽+校名横版】              │
├──────────────┬──────────────────────┤
│              │                      │
│  校园轮播图   │   【登录卡片】         │
│  （左半屏）   │   - 欢迎文字          │
│              │   - "进入系统" 按钮    │
│              │   - BJUT 蓝色主题     │
│              │                      │
└──────────────┴──────────────────────┘
```

### 主界面
```
┌─────┬──────────────────────────────┐
│ Logo│  用户信息 [退出]              │
├─────┼──────────────────────────────┤
│     │                              │
│ 数据│                              │
│ 看板│        内容区                 │
│     │                              │
│ 申请│                              │
│ 审核│                              │
│     │                              │
│ 排课│                              │
│ 管理│                              │
│     │                              │
│ 排课│                              │
│ 结果│                              │
│     │                              │
└─────┴──────────────────────────────┘
```

---

## 非功能需求

### 性能要求
1. 页面加载时间 < 2秒
2. 列表查询响应 < 1秒
3. 自动排课执行 < 5秒

### 兼容性
1. 支持 Chrome/Edge/Firefox 最新版
2. 最小分辨率 1366x768

### 可用性
1. 所有操作提供明确的成功/失败提示
2. 关键操作需二次确认
3. 加载状态显示 Loading 动画

---

**文档版本：** v2.0 (MVP)  
**创建时间：** 2025-11-05  
**需求确认：** ✅ 已简化，待用户确认
