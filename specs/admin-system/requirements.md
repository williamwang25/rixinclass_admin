# 需求文档 - 日新智课管理员端系统

## 介绍

日新智课管理员端是一个基于 Vue3 + CloudBase 的 Web 应用，用于管理教师的排课申请，实现自动排课和冲突处理功能。管理员可以通过该系统审核教师提交的排课申请，使用自动排课算法智能分配实验室，并手动处理排课冲突。

## 核心业务流程

```
教师提交申请 → 管理员查看 → 审核申请（通过/拒绝）→ 自动排课 → 检测冲突 → 手动处理 → 生成排课表
```

## 需求

### 需求 1 - 数据看板

**用户故事：** 作为管理员，我希望在首页看到系统的关键数据统计，以便快速了解系统运行状况和待处理事项。

#### 验收标准

1. When 管理员打开系统首页时，系统应当显示以下统计数据卡片：
   - 待审核申请数量（红色徽章提醒）
   - 本学期申请总数
   - 已排课数量
   - 冲突数量（橙色警告）

2. When 统计数据存在时，系统应当以卡片形式展示，包含图标、数字、标题和趋势（环比上周）

3. When 管理员点击统计卡片时，系统应当跳转到对应的详细页面（如点击"待审核"跳转到审核列表）

4. When 页面加载时，系统应当显示本学期的申请状态分布饼图（待审核/已通过/已拒绝）

5. When 页面加载时，系统应当显示实验室使用率柱状图（Top 10）

6. When 页面加载时，系统应当显示最近7天的申请趋势折线图

**设计风格：**
- 采用现代化管理后台风格
- 主色调：蓝色（#409EFF）
- 使用 Element Plus 组件库
- 卡片式布局，清晰的数据层级

---

### 需求 2 - 申请审核管理

**用户故事：** 作为管理员，我希望能够查看、筛选和审核教师提交的排课申请，以便高效处理待审核事项。

#### 验收标准

1. When 管理员进入申请审核页面时，系统应当显示所有申请的列表，默认按提交时间倒序排列

2. When 申请列表存在时，系统应当显示以下信息：
   - 申请编号
   - 教师姓名
   - 课程名称
   - 学生人数
   - 申请时间段数量
   - 申请状态（待审核/已通过/已拒绝）
   - 操作按钮

3. When 管理员选择状态筛选时，系统应当只显示对应状态的申请

4. When 管理员搜索课程名称或教师姓名时，系统应当实时过滤结果

5. When 管理员点击"查看详情"时，系统应当弹出对话框显示申请的完整信息：
   - 基本信息（学年学期、课程类型、课程代码等）
   - 课程信息（课程名称、班级、学生人数、学时）
   - 时间段列表（星期、周次、节次）
   - 软件环境要求
   - 其他要求
   - 教师信息（姓名、电话、邮箱）
   - 电子签名图片

6. When 管理员点击"通过"按钮时，系统应当弹出确认对话框，确认后更新申请状态为"已通过"，并记录审核时间和审核人

7. When 管理员点击"拒绝"按钮时，系统应当弹出输入框要求填写拒绝理由，提交后更新申请状态为"已拒绝"

8. When 审核操作成功后，系统应当显示成功提示，并刷新列表

9. When 审核操作失败时，系统应当显示详细的错误信息

10. When 申请列表超过10条时，系统应当提供分页功能

**交互要点：**
- 状态用不同颜色的标签显示（灰色/绿色/红色）
- 批量审核功能（可选）
- 快速筛选和搜索

---

### 需求 3 - 自动排课管理

**用户故事：** 作为管理员，我希望系统能够自动为已通过的申请分配实验室，并检测时间冲突，以减少手动排课的工作量。

#### 验收标准

1. When 管理员进入排课管理页面时，系统应当显示"已通过但未排课"的申请列表

2. When 管理员点击某个申请的"自动排课"按钮时，系统应当：
   - 根据学生人数匹配实验室容量
   - 根据软件要求匹配实验室环境
   - 检测所有候选实验室的时间冲突
   - 优先分配容量最小但满足条件的实验室
   - 返回排课结果或冲突信息

3. When 自动排课成功时，系统应当：
   - 显示成功提示，包含分配的实验室信息
   - 在 schedule 集合创建排课记录
   - 更新申请的排课状态

4. When 自动排课失败（存在冲突）时，系统应当：
   - 显示冲突详情（冲突的时间段、实验室、已占用的课程）
   - 在 schedule_conflict 集合记录冲突
   - 提供"手动排课"入口

5. When 管理员点击"批量自动排课"时，系统应当依次为所有未排课申请执行自动排课

6. When 批量排课完成后，系统应当显示结果统计：
   - 成功排课数量
   - 冲突数量
   - 失败原因统计

**算法要点：**
- 容量匹配：`lab.capacity >= booking.student_count`
- 软件匹配：模糊匹配 `lab.software_env` 包含 `booking.software_requirements`
- 冲突检测：检查同一实验室的时间段是否重叠

---

### 需求 4 - 冲突处理

**用户故事：** 作为管理员，我希望能够查看排课冲突的详细信息，并手动调整实验室或时间段，以解决冲突。

#### 验收标准

1. When 管理员进入冲突管理页面时，系统应当显示所有未解决的冲突列表

2. When 冲突列表存在时，系统应当显示：
   - 课程名称
   - 教师姓名
   - 冲突的实验室
   - 冲突的时间段
   - 冲突原因（时间冲突/容量不足/环境不匹配）
   - 操作按钮

3. When 管理员点击"查看冲突详情"时，系统应当显示：
   - 当前申请的完整信息
   - 冲突时间段的占用情况（哪些课程占用）
   - 可选的替代实验室列表
   - 可选的替代时间段建议

4. When 管理员选择"更换实验室"时，系统应当：
   - 显示满足条件的实验室列表
   - 允许管理员选择新实验室
   - 重新检测冲突
   - 无冲突时创建排课记录

5. When 管理员选择"联系教师调整"时，系统应当：
   - 提供备注输入框
   - 将冲突标记为"待沟通"
   - 可选：发送消息通知教师

6. When 管理员选择"拒绝申请"时，系统应当：
   - 要求填写拒绝理由
   - 更新申请状态为"已拒绝"
   - 删除冲突记录

7. When 冲突解决后，系统应当自动将其从列表中移除

**处理策略：**
- 智能推荐替代实验室（相似环境、空闲时间）
- 可视化时间冲突（日历视图）
- 批量处理相似冲突

---

### 需求 5 - 排课结果查看

**用户故事：** 作为管理员，我希望能够查看已完成的排课结果，并支持导出排课表。

#### 验收标准

1. When 管理员进入排课结果页面时，系统应当显示所有已排课的记录

2. When 排课结果列表存在时，系统应当显示：
   - 课程名称
   - 教师姓名
   - 实验室（建筑 + 房间号）
   - 时间段（周几、第几周、第几节）
   - 排课时间
   - 操作按钮（查看详情、取消排课）

3. When 管理员选择学年学期筛选时，系统应当只显示对应学期的排课

4. When 管理员点击"导出排课表"时，系统应当生成 Excel 文件，包含所有排课信息

5. When 管理员点击"日历视图"时，系统应当以周历形式展示排课（可选功能）

6. When 管理员点击"取消排课"时，系统应当：
   - 弹出确认对话框
   - 删除排课记录
   - 将申请状态恢复为"已通过但未排课"

**展示形式：**
- 表格视图（默认）
- 日历视图（可选）
- 实验室视角（按实验室分组）

---

## 非功能需求

### 性能要求
1. 页面加载时间 < 2秒
2. 列表查询响应时间 < 1秒
3. 自动排课算法执行时间 < 5秒/申请


### 兼容性要求
1. 支持 Chrome、Edge、Firefox 最新版本
2. 最小分辨率：1366x768

### 可用性要求
1. 操作流程清晰，关键操作有明确提示
2. 错误信息友好，提供解决建议
3. 加载状态明确，长时间操作显示进度

---

## 配色方案

### 主题色
- 主色：`#409EFF`（蓝色）- 按钮、链接
- 成功：`#67C23A`（绿色）- 已通过状态
- 警告：`#E6A23C`（橙色）- 冲突警告
- 危险：`#F56C6C`（红色）- 已拒绝、删除操作
- 信息：`#909399`（灰色）- 待审核状态

### 背景色
- 页面背景：`#F0F2F5`
- 卡片背景：`#FFFFFF`
- 表头背景：`#FAFAFA`

---

## 原型参考

参考 Element Plus Admin 风格：
- 顶部导航栏：Logo + 标题 + 用户菜单
- 左侧菜单栏：数据看板、申请审核、排课管理、冲突处理、排课结果
- 主内容区：面包屑 + 内容卡片

---

**文档版本：** v1.0  
**创建时间：** 2025-11-05  
**需求确认：** 待用户确认

